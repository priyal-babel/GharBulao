{% extends "users/base.html" %} {% load static %} {% load crispy_forms_tags %}
{% load static %}
{% block style %}
  <link rel="stylesheet" type="text/css" href="{% static 'users/Reviews.css' %}"
{% endblock style %}
{% block content %}
<br />
<br />
<div class="container">
  <div class="jumbotron" style="background-color: rgb(233, 233, 233)">
    <form method="POST" action='' id="post_form">
      {% csrf_token %}
      <fieldset class="form-group">
        <legend class="border-bottom mb-4" style="text-align: center">
          Share your experience to help other valuable customers!!
        </legend>
        <div class="form-group">
          <label>Review</label>
          <input
            type="text"
            class="form-control"
            id="review"
            placeholder="Add your review here..."
            required
          />
        </div>
        <div class="form-group">
          <div class="rating rating2">
            <a href="#5" title="Give 5 stars" data-value="5">★</a>
            <a href="#4" title="Give 4 stars" data-value="4">★</a>
            <a href="#3" title="Give 3 stars" data-value="3">★</a>
            <a href="#2" title="Give 2 stars" data-value="2">★</a>
            <a href="#1" title="Give 1 star" data-value="1">★</a>
          </div>
        </div>
      </fieldset>
      <div class="form-group">
        <button class="btn btn-outline-info" type="submit">Add Review</button>
      </div>
    </form>
  </div>
</div>

{% endblock content %} 
{% block js %} 
let data=0;
$(".rating a").on('click', function(e){
data = $(this).data('value')
});

$(document).on('submit',function(e){
    $.ajax({
        type:'POST',
        url:'{% url "review" %}',
        data:{
            review:$('#review').val(),
            rating: data,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
            action: ''
        },
        success:function(json){
            console.log("done!!");
            window.alert("Your review has been posted successfully!!");
            window.location.href = "http://localhost:8000/showPost/11";
        },
        error : function(xhr,errmsg,err) {
        console.log(xhr.status + ": " + xhr.responseText);
    }
    });
});

{% endblock js %}
